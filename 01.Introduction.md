#开发操作系统：导论
[原文地址](http://www.brokenthorn.com/Resources/OSDev1.html)

本系列文章的目的是演示并指导从零开始的操作系统开发。

##这是关于什么的？
操作系统是一个非常复杂的课题，因此对系统是如何工作的学习会有一个非常棒的体验。这一系列文章的目的是从零开始指导有关操作系统开发的"黑科技"。无论你是不是想做你自己的操作系统，抑或是想学习它们是如何工作的，这一系列文章就是为你而写的！

##操作系统是什么？
操作系统为计算机提供了基本的功能，交互和体验。其基本目的是为使用创建一个可用的操作环境。
Windows， Linux 和 Macintosh 就是操作系统的例子。

##如果你从未有过编程经验的话...
计算机编程指设计和编写计算机可以加载和执行的软件或程序。操作系统被设计用来提供这个功能。
一个操作系统并不是一个单一的程序，而是一系列可以进行工作和相互通信的软件。这就是我所说的"操作环境"。
因为操作系统是一系列的软件，为了开发一个操作系统，我们必须要知道如何开发软件。这就是说，我们必须懂得计算机编程。
如果你之前从未编程的话，只需要看看以下的"要求"小节。这个部分包含了很多好的指导书目与文章来帮你学习用 C++ 与 80x86 汇编。

##要求
###C 语言的知识
对一门高级语言的使用，例如说 C ，能让操作系统开发变的更加容易。在操作系统开发中最常用的语言包括 C, C++ 和 Perl 。不要认为必须要使用这些语言；事实上，其他语言也是可以的。我甚至见过使用 FreeBASIC 来进行开发的！然而，使用更高级更抽象的编程语言来开发会使得长期运行变得困难。

C 和 C+。是最常见的，其中 C 是使用最广的。C ，作为一个中级的语言，不仅提供了高级的结构还提供了底层的细节来更接近汇编语言，也因此更接近操作系统。因为这个，使用 C 来开发操作系统是很简单的。这也是为什么它被广泛使用的主要原因：因为 C 语言最初就是为系统级的开发和嵌入式所设计的。
因为这个，我们将在操作系统的大多数部分使用 C 语言。
C 是一门复杂的编程语言，我们可以通过看一本书来获得大体的认知。如果你不了解 C 的话，向你推荐以下书目：
Learn C - A complete resource for a beginner
Cprogramming.com
Thinking in C++
我个人看的是最早的 The C++ Programming Language ，但这本已经被淘汰了。

###x86 汇编的知识
80x86 汇编是一种底层编程语言。汇编语言有着与处理器指令一一对应的映射，所以汇编语言很适合硬件编程。
因为汇编语言是一种底层语言，所以其比高级语言更复杂更难使用。因为这个，并且为了简化过程，我们只在必要的时候使用汇编语言。
汇编语言是另一门需要看书来掌握的复杂语言。如果你不了解汇编，那么这个书单可能会帮到你：
Assembly Language: Step by Step
Art of Assembly
我是通过 Assembly Language: Step by Step （非常好的入门书）和 Art of Assembly 来学习的。它们都是非常好的书。

###开始吧
以上就是所有你需要学习的东西，其他的就在开发的时候再详细说明吧。预先警告：从这里开始，我将不会解释 C 或者汇编语言的概念。但我仍然会解释你可能还不熟悉的新概念，比如 lgdt , 以及 sti, cli, but, cpuid 等等的使用。


##工具
在编写底层代码时，我们需要一些专门的底层软件来协助开发。虽然这些工具并不是必需的，但因为它们能给予很大的帮助，我们还是高度推荐你来使用的。

### NASM - 汇编器
Netwide 汇编器（NASM）能产生纯 16 位二进制程序，这是大多数其他的汇编器（如 Turbo 汇编器 TASM，微软宏汇编器 MASM）做不到的。

在操作系统的开发中，一些程序必须是纯粹的二进制可执行文件。为此 NASM 是一个很好的选择。

我们可以通过这个链接下载 NASM 。

微软 Visual C++ 2005 或者 2008

因为我们关心可移植性，大多数我们的操作系统代码需要用 C 来编写。

在开发过程中，有一些东西不一定是所有的编译器都支持的，所以我们必须要控制其使用。比如，我们不能用运行时相关的特性（模版，异常）或者老旧的但好用的标准库。取决于你操作系统的设计，你可能需要支持或者改写非常细节的特性，比如在一个特定的地址进行加载，在你的二进制程序里添加内部段等。我们基本的想法是并不是所有的编译器都有能力编译操作系统的代码。

我将使用微软 Visual C++ 来开发这个系统。不过，使用其他的编译器如 DJGPP ， GCC 甚至 Cygwin 都是可以的。Cygwin 是一个用来模拟 Linux 命令解释器的程序。在 Cygwin 中有调用 GCC 的接口。

你能从这里获取 Visual C++ 2008

你仍可以在这里获取 Visual C++ 2005

对其他编译器的支持

正如之前所说的，可以使用它的编译器来开发操作系统。尽管我主要的编译器是 Visual C
++，我仍会解释如何一步步配置环境来让你可以使用你喜欢的编译器。

我将叙述如何为以下的编译器配置环境：

* DJGPP
* 微软 Visual C++ 2005
* GCC

如果可能，我将在以后试着支持以下的编译器：
* Mingw
* Pelles C

如果你想向这个清单里再添加一些的话，请联系我。


###拷贝 Boot Loader###

Bootloader 是一个储存在一个 512 B 扇区上的纯二进制程序。因为操作系统没有它就不可能工作，所以这是一个非常重要的程序。它在启动时就作为操作系统的一部分被 BIOS 直接加载并被处理器直接执行。

我们可以用 NASM 来解释这个程序，但我们如何把它装在软盘上呢？我们可不能直接拷贝文件。事实上，在格式化软盘后我们必须用自己的 bootloader 来覆写 Windows 系统放在其上的引导记录。要记住当 BIOS 查找可引导磁盘时，它只检查引导扇区。 引导扇区和引导记录是在一块的！所以我们必须覆写它。

做这件事我们有很多种方法。这里我将介绍两种。如果某一种方法在你的系统上不起作用，你可以试试另一个。

**警告：在我解释如何使用之前，不要试图操作它们。对这款软件的不正确使用会毁掉你硬盘上的数据或让你的 PC 无法启动。**

####PartCopy - 底层拷贝器####
PartCopy 允许在两个设备间进行扇区拷贝。PartCopy 代表 "Partial copy"。它的功能是从一个特定的地址拷贝一些扇区到另一个地址。
你可以从[这里](http://www.brokenthorn.com/Resources/Programs/pcopy02.zip)下载它。

####Windows Debug 命令####
windows 提供了一个在命令行下的调试器。我们能用这个软件做许多事，但这里我们只需要哟用它拷贝我们的 bootloader 到盘片的的第一个扇区。
打开命令提示符，输入`debug`.一个小的提示符将会向你打招呼(-):
```
C:\Documents and Settings\Michael>debug
-
```
这就是你输入命令的地方。`h`是帮助命令，`q`是退出命令。`w`是写命令，也是对我们最重要的。
你可以让调试器加载一个文件进内存，比如，我们的 bootloader：
```
C:\Documents and Settings\Michael>debug boot_loader.bin
-
```
它允许我们在上面进行操作。
